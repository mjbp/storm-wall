!function(t,e){"object"==typeof exports?module.exports=e():t.StormWall=e()}(this,function(){"use strict";function t(t,e,n){function i(t){document.documentElement.scrollTop=t,document.body.parentNode.scrollTop=t,document.body.scrollTop=t}function s(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}var o=s(),h=t-o,l=0,r=20;e="undefined"==typeof e?500:e;var a=function(){l+=r;var t=Math.easeInOutQuad(l,o,h,e);i(t),e>l?window.requestAnimationFrame(a):n&&"function"==typeof n&&n()};a()}function e(t,e){var n,i=0;return function(){var s=arguments,o=this,h=+new Date,l=function(){i=h,t.apply(o,s)};window.clearTimeout(n),h>=i+e?l():n=window.setTimeout(l,e)}}function n(t,e){var n=t.getBoundingClientRect();return n.right>=e.l&&n.bottom>=e.t&&n.left<=e.r&&n.top<=e.b}function i(t,e,n){this.index=n,this.element=t,this.trigger=t.querySelector(h.trigger),this.child=t.querySelector(h.child)}function s(){var t=e(function(){this.equalHeight.call(this,function(){this.setPanelTop.call(this)}.bind(this))}.bind(this),60).bind(this);this.element=document.querySelector(".js-wall"),this.elements=[].slice.call(this.element.querySelectorAll(".js-wall-item")),this.openIndex=null,this.throttledChange=e(this.change,460).bind(this),this.throttledPrevious=e(this.previous,460).bind(this),this.throttledNext=e(this.next,460).bind(this),this.items=this.elements.map(function(t,e){return new i(t,this,e)}.bind(this)),this.items.forEach(function(t){t.init(this)}.bind(this)),this.createPanel().initButtons().initListeners(),window.addEventListener("resize",t,!1),setTimeout(this.equalHeight.bind(this),10)}function o(){return document.querySelector(".js-wall")?new s:void 0}Math.easeInOutQuad=function(t,e,n,i){return t/=i/2,1>t?n/2*t*t+e:(t--,-n/2*(t*(t-2)-1)+e)};var h={trigger:".js-wall-trigger",child:".js-wall-child",panel:".js-wall-panel",open:".js-wall--is-open"};return i.prototype.init=function(t){return this.parent=t,this.initListeners(),this},i.prototype.keyFinder=function(t){var e=[13,32];e.indexOf(t.keyCode)>-1&&(t.preventDefault(),this.parent.throttledChange.call(this.parent,this.index))},i.prototype.initListeners=function(){var t=this;return this.trigger&&(this.trigger.addEventListener("click",this.parent.throttledChange.bind(this.parent,this.index),!1),this.trigger.addEventListener("keydown",function(e){t.keyFinder.call(t,e)},!1)),this},s.prototype.createPanel=function(){var t=function(t,e,n){var i=document.createElement(t);i.className=e;for(var s in n)n.hasOwnProperty(s)&&i.setAttribute(s,n[s]);return i},e=(document.createDocumentFragment(),t(this.elements[0].tagName.toLowerCase(),h.panel.substring(1),{"aria-hidden":!0}));return this.panelInner=t("div","js-wall-panel-inner"),this.panel=this.element.appendChild(e),this},s.prototype.initButtons=function(){var t=['<button class="js-wall-button-close icon-close" aria-label="close"></button>','<button class="js-wall-button-previous icon-left" aria-label="previous"></button>','<button class="js-wall-button-next icon-right" aria-label="next"></button>'].join("");return this.panel.innerHTML=this.panel.innerHTML+t,this},s.prototype.initListeners=function(){return this.panel.querySelector(".js-wall-button-close").addEventListener("click",this.close.bind(this),!1),this.panel.querySelector(".js-wall-button-previous").addEventListener("click",this.throttledPrevious.bind(this),!1),this.panel.querySelector(".js-wall-button-next").addEventListener("click",this.throttledNext.bind(this),!1),this},s.prototype.getItem=function(t){return this.items[t]},s.prototype["switch"]=function(t){return this.close(function(){this.open(t,this.panel.offsetHeight)}.bind(this),this.panel.offsetHeight)},s.prototype.previous=function(){return this.change(this.openIndex-1<0?this.items.length-1:this.openIndex-1)},s.prototype.next=function(){return this.change(this.openIndex+1===this.items.length?0:this.openIndex+1)},s.prototype.close=function(t,e,n){var i=0,s=this.panel.offsetHeight,o=(e||0)-s,h=this.elements[this.openIndex].offsetHeight,l=o,r=n||16,a=function(){i++,this.panel.style.height=Math.easeInOutQuad(i,s,o,r)+"px",this.resizeRow(this.elements[this.openIndex],Math.easeInOutQuad(i,h,l,r)+"px"),r>i?window.requestAnimationFrame(a.bind(this)):(e||(this.panel.style.height="auto"),this.panelInner.removeChild(this.panelContent),this.panelSourceContainer.appendChild(this.panelContent),this.element.classList.remove("js-is-animating"),this.element.classList.remove("js-wall--on"),this.openIndex=null,t&&"function"==typeof t&&t.call(this))};STORM.UTILS.attributelist.toggle(this.panel,"aria-hidden"),STORM.UTILS.attributelist.toggle(this.items[this.openIndex].trigger,"aria-expanded"),this.element.classList.add("js-is-animating"),a.call(this)},s.prototype.open=function(e,i,s){this.panelSourceContainer=e.child,this.openIndex=e.index,this.setPanelTop(),this.panelContent=e.child.firstElementChild.cloneNode(!0),this.panelInner.appendChild(this.panelContent),this.panelSourceContainer.removeChild(this.panelSourceContainer.firstElementChild),this.panel.insertBefore(this.panelInner,this.panel.firstElementChild);var o=0,h=i||0,l=this.panelInner.offsetHeight-h,r=this.closedHeight+h,a=l,p=s||16,u=function(){o++,this.panel.style.height=Math.easeInOutQuad(o,h,l,p)+"px",this.resizeRow(this.elements[this.openIndex],Math.easeInOutQuad(o,r,a,p)+"px"),p>o?window.requestAnimationFrame(u.bind(this)):(this.panel.style.height="auto",e.element.parentNode.insertBefore(this.panel,e.element.nextElementSibling),n(this.panel,function(){return{l:0,t:0,b:(window.innerHeight||document.documentElement.clientHeight)-this.panel.offsetHeight,r:window.innerWidth||document.documentElement.clientWidth}}.call(this))||t(this.panel.offsetTop-120))};return this.element.classList.add("js-wall--on"),STORM.UTILS.attributelist.toggle(this.panel,"aria-hidden"),STORM.UTILS.attributelist.toggle(e.trigger,"aria-expanded"),u.call(this),this},s.prototype.setPanelTop=function(){return this.panel.style.top=this.elements[this.openIndex].offsetTop+this.elements[this.openIndex].offsetHeight-this.panel.offsetHeight+"px",this},s.prototype.change=function(t){var e=this.getItem(t);if(this.element.classList.contains("js-wall--on")){if(this.openIndex===e.index)return void this.close();this.elements[this.openIndex].offsetTop===e.element.offsetTop?this["switch"](e):this.close(function(){this.open(e)}.bind(this))}else this.open(e);return this},s.prototype.resizeRow=function(t,e){return this.items.forEach(function(n){n.element.offsetTop===t.offsetTop&&(n.element.style.height=e)}),this},s.prototype.equalHeight=function(t){var e=0,n=0;this.items.forEach(function(t){null!==this.openIndex&&t.element.offsetTop===this.elements[this.openIndex].offsetTop?this.openIndex===t.index&&(t.element.style.height="auto",e=t.element.offsetHeight+this.panel.offsetHeight):(t.element.style.height="auto",t.element.offsetHeight>n&&(n=t.element.offsetHeight))}.bind(this)),this.openHeight=e,this.closedHeight=0===n?this.closedHeight:n,this.items.forEach(function(t){this.openIndex!==t.index&&(t.element.style.height=n+"px")}.bind(this)),this.openHeight>0&&(this.resizeRow(this.getItem(this.openIndex).element,this.openHeight+"px"),t&&t())},{init:o}});